<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xenocord | Вход</title>
    <link rel="stylesheet" href="style.css">
</head>
<body style="display: flex; align-items: center; justify-content: center; background: #1e1f22;">

    <div class="auth-card" style="background: #313338; padding: 32px; border-radius: 8px; width: 400px; box-shadow: 0 8px 16px rgba(0,0,0,0.2);">
        <h2 style="color: white; text-align: center; margin-bottom: 8px;">С возвращением!</h2>
        <p style="color: #b5bac1; text-align: center; margin-bottom: 20px;">Мы так рады видеть вас снова!</p>
        
        <div class="input-group" style="margin-bottom: 20px;">
            <label style="color: #b5bac1; display: block; font-size: 12px; font-weight: bold; margin-bottom: 8px; text-transform: uppercase;">Адрес электронной почты</label>
            <input type="email" id="emailInput" style="width: 100%; background: #1e1f22; border: none; padding: 10px; color: white; border-radius: 3px;">
        </div>

        <div class="input-group" style="margin-bottom: 20px;">
            <label style="color: #b5bac1; display: block; font-size: 12px; font-weight: bold; margin-bottom: 8px; text-transform: uppercase;">Пароль</label>
            <input type="password" id="passInput" style="width: 100%; background: #1e1f22; border: none; padding: 10px; color: white; border-radius: 3px;">
        </div>

        <button id="loginBtn" class="btn-primary" style="width: 100%; padding: 12px; margin-bottom: 12px; font-weight: bold;">Вход</button>
        <button id="regBtn" style="width: 100%; background: none; border: none; color: #00a8fc; cursor: pointer; font-size: 14px;">Нужна учетная запись? Зарегистрироваться</button>
    </div>

    <script type="module">
        import { auth } from "./firebase.js";
        import { signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const db = getFirestore();

        // Функция входа
        document.getElementById('loginBtn').onclick = async () => {
            const email = document.getElementById('emailInput').value;
            const pass = document.getElementById('passInput').value;
            try {
                await signInWithEmailAndPassword(auth, email, pass);
                window.location.href = "app.html";
            } catch (e) {
                alert("Ошибка входа: " + e.message);
            }
        };

        // Функция регистрации
        document.getElementById('regBtn').onclick = async () => {
            const email = document.getElementById('emailInput').value;
            const pass = document.getElementById('passInput').value;
            if (confirm("Создать новый аккаунт с этими данными?")) {
                try {
                    const res = await createUserWithEmailAndPassword(auth, email, pass);
                    // Создаем базовый профиль в БД
                    await setDoc(doc(db, "users", res.user.uid), {
                        nick: "Новый пользователь",
                        bio: "Я здесь новенький",
                        friends: [],
                        pending: []
                    });
                    window.location.href = "app.html";
                } catch (e) {
                    alert("Ошибка регистрации: " + e.message);
                }
            }
        };
    </script>
</body>
</html>
